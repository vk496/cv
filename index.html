<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"
        integrity="sha256-Rdw90D3AegZwWiwpibjH9wkBPwS9U4bjJ51ORH8H69c=" crossorigin="anonymous"></script>
    <script>
        function consumeSkills() {
            let base_skill = document.getElementById('template_skill')
            let parent_skill = document.getElementById('parent_skill');
            oYAML.skills.forEach(function (item, index) {
                // Object.keys(item)[0]
                var clone2 = document.importNode(base_skill.content, true);
                // Set name
                clone2.querySelector('label').textContent = Object.keys(item)[0];
                // Fix reference of label to the input
                clone2.querySelector('label').setAttribute('for', 'skill' + index)
                clone2.querySelector('input').setAttribute('id', 'skill' + index)
                parent_skill.insertBefore(clone2, base_skill);
            });
        }

        function consumeExperience() {
            let base_experience = document.getElementById('template_experience');
            let parent_experience = document.getElementById('parent_experience');

            oYAML.education_experience
                .map(elem => {
                    if (!elem.stop) {
                        elem.stop = new Date()
                    }
                    return elem
                })
                .sort((a, b) => { return a.start < b.start })
                .forEach(function (item) {
                    var clone2 = document.importNode(base_experience.content, true);
                    // Year
                    startDate = (new Date(item.start))
                    stopDate = (new Date((item.stop)))
                    clone2.querySelector(".cv-year").textContent = startDate.getFullYear() + " - " + stopDate.getFullYear()

                    // Name
                    clone2.querySelector(".cv-name").textContent = item.name

                    // Description
                    clone2.querySelector(".cv-description").textContent = item.description

                    // Location
                    if (item.location) {
                        clone2.querySelector(".cv-location").textContent = item.location.city
                    }

                    // Insert
                    parent_experience.insertBefore(clone2, base_experience);
                });
        }

        function consumeProjects() {
            let base_projects = document.getElementById('template_projects');
            let parent_projects = document.getElementById('parent_projects');
            oYAML.projects
                // .map(elem => {
                //     if (!elem.stop) {
                //         d = new Date()
                //         // d.setFullYear(d.getFullYear())
                //         elem.stop = d
                //     }
                //     return elem
                // })
                .sort((a, b) => {
                    // If still ongoing project, 
                    // priorize newer
                    if (!a.stop || !b.stop) {
                        return a.start < b.start
                    }
                    return a.stop < b.stop
                })
                .forEach(function (item) {
                    var clone2 = document.importNode(base_projects.content, true);
                    // Year
                    stopDate = (new Date((item.stop)))
                    startDate = (new Date((item.start)))

                    // if range is too short, just show the month
                    if (startDate.getFullYear() == stopDate.getFullYear()) {
                        clone2.querySelector(".cv-year").textContent = stopDate.getFullYear() + " " + stopDate.toLocaleDateString("en", { month: 'short' })
                    } else {
                        clone2.querySelector(".cv-year").textContent = startDate.getFullYear() + " - " + (stopDate.getFullYear() || "Present")
                    }

                    // Name
                    clone2.querySelector(".cv-name").textContent = item.name

                    // Description
                    clone2.querySelector(".cv-description").textContent = item.description

                    // Insert
                    parent_projects.insertBefore(clone2, base_projects);
                });
        }
    </script>
    <script>
        var oYAML
        // ##############
        // Start here :)
        // ##############
        fetch('cv.yml')
            .then(response => {
                if (!response.ok) throw new Error(response.status);
                return response.text()
            })
            .then(data => {
                oYAML = jsyaml.load(data)
                consumeData();
            })
            .catch((error) => alert(error))

        function consumeData() {
            // Init Skills array
            consumeSkills()

            consumeExperience()

            consumeProjects()

        }
    </script>

    <title>Hello, world!</title>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-3 border">
                <div class="row mb-2">
                    <h2>Contact</h2>
                    <div id="firstname">Valentín KIVACHUK BURDÁ</div>
                    <div id="email">cv@vk496.es</div>
                </div>
                <div class="row">
                    <h2>Languages</h2>
                    <div>Spanish</div>
                </div>
                <div class="row">
                    <h2>Skills</h2>
                    <div id="parent_skill" class="row row-cols-auto btn-group" role="group">
                        <template id="template_skill">
                            <input type="checkbox" class="btn-check" id="btncheck1" autocomplete="off">
                            <label class="btn btn-outline-primary m-1" for="btncheck1">Checkbox 1</label>
                        </template>
                    </div>
                </div>
            </div>
            <div class="col border">
                <!-- Education & Experience -->

                <h2>Education & Experience</h2>
                <div id="parent_experience" class="contaienr">
                    <template id="template_experience">
                        <div class="row border cv-experience">
                            <div class="col-2 border cv-year">
                                <!-- 2014-2018 -->
                            </div>
                            <div class="col border cv-name">
                                <!-- Erasmus Internship -->
                            </div>
                            <div class="col-3 border cv-location">
                                <!-- NXP Semiconductors -->
                            </div>
                            <div class="row">
                                <div class="col-auto offset-2 border cv-description">
                                    <!--  -->
                                </div>
                            </div>
                        </div>
                    </template>
                </div>


                <!-- Projects -->

                <h2>Projects</h2>
                <div id="parent_projects" class="container">
                    <template id="template_projects">
                        <div class="row my-4 border cv-projects">
                            <div class="col-auto border cv-year">
                                2014-2018
                            </div>
                            <div class="col border">
                                <div class="row border cv-name">
                                    Erasmus Internship
                                </div>
                                <div class="row border cv-description">
                                    Lorem Ipsum
                                </div>
                            </div>
                            <!-- <div class="col-3 border cv-location">
                                NXP Semiconductors
                            </div> -->
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>


</body>

</html>